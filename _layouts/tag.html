---
layout: default
---

<div class="stories-page">
  <!-- Mobile Authors/Tags Toggle -->
  <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
    <span>Authors &amp; Tags</span>
    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
      <path d="M7 10l5 5 5-5z"/>
    </svg>
  </button>

  <div class="stories-container">
    <!-- Sidebar with Authors and Tags -->
    <aside class="stories-sidebar" id="storiesSidebar">
      <div class="sidebar-section">
        <h3>Authors</h3>
        <ul class="author-list">
          {% assign authors = site.stories | map: "author" | uniq | sort %}
          {% for author in authors %}
            {% assign author_stories = site.stories | where: "author", author %}
            {% assign author_slug = author | slugify %}
            <li>
              <a href="{{ site.baseurl }}/pages/authors/{{ author_slug }}">
                {{ author }} <span class="count">({{ author_stories.size }})</span>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>

      <div class="sidebar-section">
        <h3>Tags</h3>
        <div class="tag-cloud">
          {% comment %}Collect unique tag slugs and count stories per slug{% endcomment %}
          {% assign tag_slugs = "" | split: "" %}
          {% assign tag_names = "" | split: "" %}
          {% for story in site.stories %}
            {% for tag in story.tags %}
              {% assign tag_slug = tag | slugify %}
              {% unless tag_slugs contains tag_slug %}
                {% assign tag_slugs = tag_slugs | push: tag_slug %}
                {% assign tag_names = tag_names | push: tag %}
              {% endunless %}
            {% endfor %}
          {% endfor %}
          {% assign sorted_slugs = tag_slugs | sort %}
          {% assign page_tag_slug = page.tag | slugify %}
          {% for slug in sorted_slugs %}
            {% assign story_count = 0 %}
            {% for story in site.stories %}
              {% for tag in story.tags %}
                {% assign t_slug = tag | slugify %}
                {% if t_slug == slug %}
                  {% assign story_count = story_count | plus: 1 %}
                  {% break %}
                {% endif %}
              {% endfor %}
            {% endfor %}
            {% comment %}Find original tag name for display{% endcomment %}
            {% for i in (0..tag_slugs.size) %}
              {% if tag_slugs[i] == slug %}
                {% assign display_tag = tag_names[i] %}
                {% break %}
              {% endif %}
            {% endfor %}
            <a href="{{ site.baseurl }}/pages/tags/{{ slug }}" class="tag" {% if slug == page_tag_slug %}style="background-color: #A52A2A; color: white;"{% endif %}>
              {{ display_tag | downcase }} <span class="count">({{ story_count }})</span>
            </a>
          {% endfor %}
        </div>
      </div>

      <div class="sidebar-section">
        <a href="{{ '/submit/' | absolute_url }}" class="submit-link-btn">
          ✏️ Submit a Story
        </a>
      </div>
    </aside>

    <!-- Main Stories List -->
    <main class="stories-main">
      <h1>Stories tagged "{{ page.tag }}"</h1>
      <p class="filter-notice">
        <a href="{{ '/' | absolute_url }}" class="clear-filter">&larr; Back to all stories</a>
      </p>

      {{ content }}

      <div class="story-list">
        {% assign page_tag_slug = page.tag | slugify %}
        {% assign tagged_stories = "" | split: "" %}
        {% for story in site.stories %}
          {% for tag in story.tags %}
            {% assign tag_slug = tag | slugify %}
            {% if tag_slug == page_tag_slug %}
              {% assign tagged_stories = tagged_stories | push: story %}
              {% break %}
            {% endif %}
          {% endfor %}
        {% endfor %}
        {% assign tagged_stories = tagged_stories | sort: "date" | reverse %}
        
        {% for story in tagged_stories %}
          {% assign story_author_slug = story.author | slugify %}
          <article class="story-preview">
            <h2 class="story-title">
              <a href="{{ story.url | absolute_url }}">{{ story.title }}</a>
            </h2>
            <div class="story-meta">
              <span class="story-author">
                By <a href="{{ site.baseurl }}/pages/authors/{{ story_author_slug }}">{{ story.author }}</a>
              </span>
              <span class="story-date">{{ story.date | date: "%B %-d, %Y" }}</span>
            </div>
            {% if story.tags.size > 0 %}
            <div class="story-tags">
              {% for tag in story.tags %}
                {% assign tag_slug = tag | slugify %}
                <a href="{{ site.baseurl }}/pages/tags/{{ tag_slug }}" class="tag" {% if tag_slug == page_tag_slug %}style="background-color: #A52A2A; color: white;"{% endif %}>{{ tag | downcase }}</a>
              {% endfor %}
            </div>
            {% endif %}
            <p class="story-excerpt">
              {{ story.excerpt | strip_html | truncatewords: 50 }}
            </p>
            <a href="{{ story.url | absolute_url }}" class="read-more">Read more &rarr;</a>
          </article>
        {% endfor %}
      </div>
    </main>
  </div>
</div>

<script src="{{ '/assets/js/stories.js' | absolute_url }}"></script>
