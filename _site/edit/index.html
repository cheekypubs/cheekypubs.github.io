<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Edit a Story | Cheeky Pubs</title>
    
    <link rel="stylesheet" href="http://localhost:4001/assets/css/style.css">
    <link rel="icon" type="image/png" href="http://localhost:4001/assets/images/logo/favicon.png">
    <link rel="apple-touch-icon" href="http://localhost:4001/assets/images/logo/apple-touch-icon.png">
</head>
<body>

    <header class="header">
        <div class="logo">
    <a href="http://localhost:4001/">
        <img src="http://localhost:4001/assets/images/logo/Cheekypub.png" alt="Cheekypub Logo">
    </a>
</div>

<nav class="nav-links" id="nav-menu">
    <ul>
        <li><a href="http://localhost:4001/">Stories</a></li>
        <li><a href="http://localhost:4001/about/">About</a></li>
        <li><a href="http://localhost:4001/submit-info/">Submit</a></li>
        <li><a href="https://cheekyparties.github.io" target="_blank" rel="noopener noreferrer" class="external-link">Parties ‚Üó</a></li>
    </ul>
</nav>

<button class="hamburger-btn" aria-label="Toggle navigation menu" aria-expanded="false">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
</button>

    </header>

    <main class="main-content">
        <div class="page-container">
          <div class="edit-page">
  <h1>Edit a Story</h1>
  
  <!-- Password Gate -->
  <div id="passwordGate" class="password-gate">
    <div class="password-container">
      <h2>üîí Password Required</h2>
      <p>Enter the submission password to access the story editing form.</p>
      <div class="password-form">
        <input type="password" id="passwordInput" placeholder="Enter password" autocomplete="off">
        <button type="button" id="passwordSubmit" class="btn-primary">Enter</button>
      </div>
      <p id="passwordError" class="error-message" style="display: none;">Incorrect password. Please try again.</p>
    </div>
  </div>

  <!-- Story Editing Form (hidden until password is correct) -->
  <div id="editingForm" class="editing-form" style="display: none;">
    <p class="form-intro">Select a story to edit and make your changes below.</p>
    
    <form id="storyEditForm">
      <!-- Story Selection -->
      <div class="form-group">
        <label for="storySelect">Select Story to Edit *<\/label>
        <select id="storySelect" name="storySelect">
          <option value="">Loading stories...</option>
        </select>
        <small class="form-hint">Choose a story to edit its details and content.</small>
      </div>

      <!-- Story Preview (disabled, for reference) -->
      <div id="storyPreview" style="display: none;">
        <div class="form-group">
          <label>Current File Path<\/label>
          <input type="text" id="currentFilePath" disabled style="background-color: #f0f0f0;">
          <small class="form-hint">This shows the current filename. You can change it by editing title, author, and date.</small>
        </div>
      </div>

      <!-- Edit Fields -->
      <div class="form-group">
        <label for="editTitle">Story Title *<\/label>
        <input type="text" id="editTitle" name="title" required placeholder="Enter story title">
      </div>

      <div class="form-group">
        <label for="editAuthor">Author Name *<\/label>
        <input type="text" id="editAuthor" name="author" required placeholder="Author name">
      </div>

      <div class="form-group">
        <label for="editDate">Date *<\/label>
        <input type="date" id="editDate" name="date" required>
        <small class="form-hint">Date the story was last updated.</small>
      </div>

      <!-- Tags -->
      <div class="form-group">
        <label for="editTags">Tags<\/label>
        <input type="text" id="editTags" name="tags" placeholder="e.g., romance, drama, fiction (comma separated)">
        <small class="form-hint">Separate multiple tags with commas. All tags will be displayed in lowercase.</small>
      </div>

      <!-- Description -->
      <div class="form-group">
        <label for="editDescription">Short Description<\/label>
        <input type="text" id="editDescription" name="description" placeholder="A one-sentence summary of the story" maxlength="200">
        <small class="form-hint">A brief description shown on the story listing page (max 200 characters). Only needed for standalone stories or the first chapter of a series.</small>
      </div>

      <!-- Story ID & Chapter Info -->
      <div class="form-group">
        <label for="editStoryId">Story ID (for series)<\/label>
        <input type="text" id="editStoryId" name="story_id" placeholder="e.g., hudsons-best">
        <small class="form-hint">Leave blank for standalone stories. Use this for multi-chapter series.</small>
      </div>

      <div class="form-group">
        <label for="editChapter">Chapter Number<\/label>
        <input type="number" id="editChapter" name="chapter" min="1" placeholder="1">
        <small class="form-hint">Leave blank for standalone stories.</small>
      </div>

      <div class="form-group">
        <label for="editChapterTitle">Chapter Title (Optional)<\/label>
        <input type="text" id="editChapterTitle" name="chapter_title" placeholder="e.g., The Beginning">
        <small class="form-hint">An optional subtitle for this chapter.</small>
      </div>

      <!-- Story Content -->
      <div class="form-group">
        <label for="editContent">Story Content *<\/label>
        <textarea id="editContent" name="content" required rows="20" placeholder="Story content here. You can use Markdown formatting."></textarea>
        <small class="form-hint">You can use <a href="https://www.markdownguide.org/basic-syntax/" target="_blank" rel="noopener">Markdown</a> for formatting (bold, italic, headers, etc.)</small>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="btn-primary btn-submit" id="updateBtn">
          <span class="btn-text">Update Story<\/span>
          <span class="btn-loading" style="display: none;">Updating...<\/span>
        </button>
        <button type="button" class="btn-secondary" onclick="clearForm()">Clear Form<\/button>
      </div>

      <!-- Delete Story -->
      <div class="form-group" style="margin-top: 2rem; border-top: 1px solid #e0e0e0; padding-top: 1.5rem;">
        <label style="color: #c0392b;">Danger Zone<\/label>
        <small class="form-hint">Permanently delete this story. This action cannot be undone.<\/small>
        <div style="margin-top: 0.5rem;">
          <button type="button" class="btn-danger" id="deleteBtn">
            <span class="btn-text">Delete Story<\/span>
            <span class="btn-loading" style="display: none;">Deleting...<\/span>
          </button>
        </div>
      </div>
    </form>

    <!-- Success Message -->
    <div id="editSuccess" class="edit-success" style="display: none;">
      <h2>‚úÖ Story Updated!<\/h2>
      <p>Your story has been successfully updated.<\/p>
      <button type="button" class="btn-primary" onclick="location.reload();">Edit Another Story<\/button>
      <p><a href="http://localhost:4001/">Return to Stories<\/a></p>
    </div>

    <!-- Delete Success Message -->
    <div id="deleteSuccess" class="edit-success" style="display: none;">
      <h2>üóëÔ∏è Story Deleted!<\/h2>
      <p>The story has been permanently deleted.<\/p>
      <button type="button" class="btn-primary" onclick="location.reload();">Back to Edit<\/button>
      <p><a href="http://localhost:4001/">Return to Stories<\/a></p>
    </div>

    <!-- Error Message -->
    <div id="editError" class="edit-error" style="display: none;">
      <h2>‚ùå Update Error<\/h2>
      <p>There was an error updating your story. Please try again or contact us if the problem persists.<\/p>
      <p id="errorDetails"><\/p>
      <button type="button" class="btn-secondary" onclick="document.getElementById('editError').style.display='none'; document.getElementById('storyEditForm').style.display='block';">Try Again<\/button>
    </div>

    <!-- Delete Error Message -->
    <div id="deleteError" class="edit-error" style="display: none;">
      <h2>‚ùå Delete Error<\/h2>
      <p>There was an error deleting the story. Please try again or contact us if the problem persists.<\/p>
      <p id="deleteErrorDetails"><\/p>
      <button type="button" class="btn-secondary" onclick="document.getElementById('deleteError').style.display='none'; document.getElementById('storyEditForm').style.display='block';">Try Again<\/button>
    </div>
  </div>
</div>

<script src="http://localhost:4001/assets/js/edit-story.js"><\/script>
        </div>
    </main>

    <footer class="footer">
        <div class="social-links">
    <a href="https://twitter.com/cheekyspankos" target="_blank" rel="noopener">
        <img src="http://localhost:4001/assets/images/socials/twitter.svg" alt="Twitter">
    </a>
    <a href="https://www.fetlife.com/groups/170517" target="_blank" rel="noopener">
        <img src="http://localhost:4001/assets/images/socials/fetlife.svg" alt="FetLife">
    </a>
    <a href="mailto:cheekypubs@gmail.com">
        <img src="http://localhost:4001/assets/images/socials/email.svg" alt="Email">
    </a>
</div>
<p>&copy; 2026 Cheeky Pubs. All rights reserved.</p>
<p class="admin-link"><a href="http://localhost:4001/submit/">Admin Login</a></p>

    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top" aria-label="Back to top" title="Back to top">
      <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
        <path d="M12 4l-8 8h5v8h6v-8h5z"/>
      </svg>
    </button>
    
    <script src="http://localhost:4001/assets/js/hamburger.js"></script>
    <script>
      // Back to top button
      (function() {
        var btn = document.getElementById('backToTop');
        if (!btn) return;
        window.addEventListener('scroll', function() {
          btn.classList.toggle('visible', window.scrollY > 400);
        });
        btn.addEventListener('click', function() {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
      })();
    </script>
</body>
</html>
